{% extends "base_dashboard.html" %}

{% block title %}Ã–ÄŸrenci Dashboard{% endblock %}

{% block content %}
<div class="page-header" style="background: white; padding: 25px 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 30px;">
    <h1 style="font-size: 1.8em; color: #1f2937; margin-bottom: 5px;">ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci Dashboard</h1>
    <p style="color: #6b7280; font-size: 0.95em;">Dersler, Ã¶devler ve sÄ±navlarÄ±m</p>
</div>

<div style="padding: 20px 30px;">
    <h2 style="margin-bottom: 20px; color: #374151;">HÄ±zlÄ± EriÅŸim</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div onclick="window.location.href='/student/exams'" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 15px; padding: 30px; text-align: center; cursor: pointer; color: white;">
            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“</div>
            <h3 style="margin-bottom: 10px;">SÄ±navlarÄ±m</h3>
            <p style="font-size: 0.9em; opacity: 0.9;">SÄ±navlarÄ± gÃ¶rÃ¼ntÃ¼le ve cevapla</p>
        </div>
        <div onclick="window.location.href='/student/assignments'" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 15px; padding: 30px; text-align: center; cursor: pointer; color: white;">
            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“š</div>
            <h3 style="margin-bottom: 10px;">Ã–devlerim</h3>
            <p style="font-size: 0.9em; opacity: 0.9;">Ã–dev teslim et ve notlarÄ± gÃ¶r</p>
        </div>
        <div onclick="window.location.href='/student/announcements'" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 15px; padding: 30px; text-align: center; cursor: pointer; color: white;">
            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“¢</div>
            <h3 style="margin-bottom: 10px;">Duyurular</h3>
            <p style="font-size: 0.9em; opacity: 0.9;">Ã–ÄŸretmen duyurularÄ±nÄ± oku</p>
        </div>
        <div onclick="window.location.href='/student/ask-question-page'" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 15px; padding: 30px; text-align: center; cursor: pointer; color: white;">
            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ’¬</div>
            <h3 style="margin-bottom: 10px;">Soru Sor</h3>
            <p style="font-size: 0.9em; opacity: 0.9;">Ã–ÄŸretmene soru sor</p>
        </div>
    </div>
    
    <!-- Gamification Section (Task #7) -->
    <h2 style="margin-top: 40px; margin-bottom: 20px; color: #374151;">ğŸ† BaÅŸarÄ±larÄ±m</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <!-- Badges Card -->
        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-bottom: 15px; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5em;">ğŸ…</span>
                Rozetlerim
            </h3>
            <div id="badgesContainer" style="min-height: 100px;">
                <div style="text-align: center; padding: 20px; color: #9ca3af;">
                    YÃ¼kleniyor...
                </div>
            </div>
        </div>
        
        <!-- Leaderboard Card -->
        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-bottom: 5px; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5em;">ğŸ“Š</span>
                Lider Tablosu
            </h3>
            <div id="leaderboardClass" style="font-size: 0.85em; color: #6b7280; margin-bottom: 15px;"></div>
            <div id="leaderboardContainer" style="min-height: 100px;">
                <div style="text-align: center; padding: 20px; color: #9ca3af;">
                    YÃ¼kleniyor...
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Gamification API calls (Task #7)
async function loadBadges() {
    try {
        const response = await fetch('/api/student/badges');
        const data = await response.json();
        
        const container = document.getElementById('badgesContainer');
        if (data.badges && data.badges.length > 0) {
            let html = '<div style="display: grid; gap: 10px;">';
            data.badges.forEach(badge => {
                html += `
                    <div style="padding: 12px; background: #f9fafb; border-radius: 8px; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.8em;">ğŸ…</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #1f2937;">${badge.title}</div>
                            ${badge.description ? `<div style="font-size: 0.85em; color: #6b7280;">${badge.description}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        } else {
            container.innerHTML = '<div style="text-align: center; padding: 30px; color: #9ca3af;">HenÃ¼z rozet kazanmadÄ±nÄ±z. SÄ±navlara katÄ±lÄ±n ve Ã¶devlerinizi tamamlayÄ±n!</div>';
        }
    } catch (error) {
        console.error('Badges load error:', error);
        document.getElementById('badgesContainer').innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">YÃ¼klenemedi</div>';
    }
}

async function loadLeaderboard() {
    try {
        const response = await fetch('/api/student/leaderboard');
        const data = await response.json();
        
        const container = document.getElementById('leaderboardContainer');
        const classLabel = document.getElementById('leaderboardClass');
        
        if (data.leaderboard && data.leaderboard.length > 0) {
            // Show class filter label (API returns 'class' not 'class_name')
            const firstStudent = data.leaderboard[0];
            if (firstStudent.class) {
                classLabel.textContent = `SÄ±nÄ±f: ${firstStudent.class}`;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
            data.leaderboard.forEach(student => {
                const isMe = student.is_me;
                const rankEmoji = student.rank === 1 ? 'ğŸ¥‡' : student.rank === 2 ? 'ğŸ¥ˆ' : student.rank === 3 ? 'ğŸ¥‰' : `${student.rank}.`;
                html += `
                    <div style="padding: 10px; background: ${isMe ? '#eff6ff' : '#f9fafb'}; border-radius: 8px; display: flex; align-items: center; gap: 10px; ${isMe ? 'border: 2px solid #3b82f6;' : ''}">
                        <div style="font-size: 1.3em; min-width: 35px; text-align: center;">${rankEmoji}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: ${isMe ? '700' : '600'}; color: #1f2937;">${student.name}${isMe ? ' (Sen)' : ''}</div>
                            <div style="font-size: 0.85em; color: #6b7280;">${student.points} puan â€¢ ${student.exams} sÄ±nav â€¢ ${student.assignments} Ã¶dev</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        } else {
            container.innerHTML = '<div style="text-align: center; padding: 30px; color: #9ca3af;">HenÃ¼z lider tablosu verisi yok</div>';
        }
    } catch (error) {
        console.error('Leaderboard load error:', error);
        document.getElementById('leaderboardContainer').innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">YÃ¼klenemedi</div>';
    }
}

// Load on page load
document.addEventListener('DOMContentLoaded', () => {
    loadBadges();
    loadLeaderboard();
});
</script>
{% endblock %}
