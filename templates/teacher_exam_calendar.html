{% extends "base_dashboard.html" %}

{% block title %}Sƒ±nav Takvimi{% endblock %}

{% block content %}
<nav class="breadcrumb-nav">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/teacher/dashboard">Ana Sayfa</a></li>
        <li class="breadcrumb-item active">Sƒ±nav Takvimi</li>
    </ol>
</nav>

<div style="max-width: 1000px; margin: 0 auto;">
    <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h2 style="margin-bottom: 20px; color: #374151;">üìÖ Yakla≈üan Sƒ±navlar</h2>
        
        <div id="examList">
            <p style="text-align: center; color: #9ca3af; padding: 40px;">Y√ºkleniyor...</p>
        </div>
    </div>
</div>

<script>
async function loadExams() {
    try {
        const response = await fetch('/api/exam-calendar/all');
        const data = await response.json();
        
        const exams = data.exams || [];
        const listDiv = document.getElementById('examList');
        
        if (exams.length === 0) {
            listDiv.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px;">Yakla≈üan sƒ±nav bulunmuyor</p>';
            return;
        }
        
        // Backend'den zaten filtrelenmi≈ü gelecek sƒ±navlar geliyor
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        let html = '<table style="width: 100%; border-collapse: collapse;">';
        html += '<thead><tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">';
        html += '<th style="padding: 12px; text-align: left;">Tarih</th>';
        html += '<th style="padding: 12px; text-align: left;">Sƒ±nav Adƒ±</th>';
        html += '<th style="padding: 12px; text-align: left;">Sƒ±nƒ±flar</th>';
        html += '<th style="padding: 12px; text-align: center;">Kalan S√ºre</th>';
        html += '</tr></thead><tbody>';
        
        exams.forEach(exam => {
            const dateObj = new Date(exam.date + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('tr-TR', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
            const dayName = dateObj.toLocaleDateString('tr-TR', { weekday: 'long' });
            
            // Kalan g√ºn hesapla
            const diffTime = dateObj - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let daysText = '';
            let daysColor = '#10b981';
            let daysBg = '#d1fae5';
            
            if (diffDays === 0) {
                daysText = 'Bug√ºn';
                daysColor = '#ef4444';
                daysBg = '#fee2e2';
            } else if (diffDays === 1) {
                daysText = 'Yarƒ±n';
                daysColor = '#f59e0b';
                daysBg = '#fef3c7';
            } else if (diffDays <= 7) {
                daysText = `${diffDays} g√ºn`;
                daysColor = '#f59e0b';
                daysBg = '#fef3c7';
            } else {
                daysText = `${diffDays} g√ºn`;
            }
            
            html += '<tr style="border-bottom: 1px solid #e5e7eb;">';
            html += `<td style="padding: 12px;">
                <div style="font-weight: 500;">${formattedDate}</div>
                <div style="font-size: 0.85em; color: #6b7280;">${dayName}</div>
            </td>`;
            html += `<td style="padding: 12px; font-weight: 500;">${exam.title || exam.description}</td>`;
            html += `<td style="padding: 12px; color: #6b7280;">${exam.classes || '-'}</td>`;
            html += `<td style="padding: 12px; text-align: center;">
                <span style="background: ${daysBg}; color: ${daysColor}; padding: 6px 12px; border-radius: 6px; font-weight: 600; font-size: 0.9em;">
                    ${daysText}
                </span>
            </td>`;
            html += '</tr>';
        });
        
        html += '</tbody></table>';
        listDiv.innerHTML = html;
        
    } catch (error) {
        console.error('Sƒ±navlar y√ºklenemedi:', error);
        document.getElementById('examList').innerHTML = 
            '<p style="text-align: center; color: #ef4444; padding: 40px;">‚ùå Sƒ±navlar y√ºklenirken hata olu≈ütu</p>';
    }
}

loadExams();
</script>
{% endblock %}
