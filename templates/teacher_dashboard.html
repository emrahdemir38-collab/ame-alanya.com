{% set breadcrumbs = [{'text': 'Dashboard', 'url': ''}] %}
{% extends "base_dashboard.html" %}

{% block title %}Ã–ÄŸretmen Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/admin-modern.css">
<style>
    .dashboard-content {
        padding: 24px 28px;
    }
    
    .quick-access-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-top: 24px;
    }
    
    .quick-card {
        background: var(--gradient-primary);
        border-radius: var(--radius-xl);
        padding: 28px;
        text-align: center;
        cursor: pointer;
        color: white;
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
    }
    
    .quick-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255,255,255,0.1);
        opacity: 0;
        transition: opacity var(--transition-fast);
    }
    
    .quick-card:hover {
        transform: translateY(-6px) scale(1.02);
    }
    
    .quick-card:hover::before {
        opacity: 1;
    }
    
    .quick-card.exams { background: var(--gradient-ocean); box-shadow: var(--shadow-primary); }
    .quick-card.assignments { background: var(--gradient-forest); box-shadow: var(--shadow-success); }
    .quick-card.announcements { background: var(--gradient-sunset); box-shadow: var(--shadow-warning); }
    .quick-card.questions { background: var(--gradient-candy); box-shadow: var(--shadow-primary); }
    .quick-card.reports { background: var(--gradient-info); box-shadow: var(--shadow-info); }
    .quick-card.bookworm { background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%); }
    
    .quick-card-icon {
        font-size: 3.5rem;
        margin-bottom: 16px;
        display: block;
    }
    
    .quick-card h3 {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 8px;
    }
    
    .quick-card p {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .upcoming-widget {
        background: white;
        border-radius: var(--radius-xl);
        padding: 24px;
        margin-bottom: 28px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--gray-100);
    }
    
    .widget-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--gray-100);
    }
    
    .widget-header h2 {
        color: var(--gray-800);
        font-size: 1.3rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .widget-header a {
        color: var(--primary-600);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        transition: color var(--transition-fast);
    }
    
    .widget-header a:hover {
        color: var(--primary-700);
    }
    
    .exam-item {
        border-left: 4px solid var(--primary-500);
        padding: 14px 18px;
        background: var(--gray-50);
        border-radius: var(--radius-md);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        transition: all var(--transition-fast);
    }
    
    .exam-item:hover {
        background: white;
        box-shadow: var(--shadow-sm);
    }
    
    .exam-item:last-child {
        margin-bottom: 0;
    }
    
    .exam-item-title {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 4px;
    }
    
    .exam-item-meta {
        font-size: 0.85rem;
        color: var(--gray-500);
    }
    
    .exam-badge {
        padding: 6px 14px;
        border-radius: var(--radius-full);
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .exam-badge.today { background: var(--error-500); color: white; }
    .exam-badge.tomorrow { background: var(--warning-500); color: white; }
    .exam-badge.soon { background: var(--info-500); color: white; }
    .exam-badge.later { background: var(--success-500); color: white; }
    
    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    @media (max-width: 768px) {
        .dashboard-content {
            padding: 16px;
        }
        
        .quick-access-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .quick-card {
            padding: 20px;
        }
        
        .quick-card-icon {
            font-size: 2.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-content">
    <div class="page-header-modern">
        <h1>ğŸ‘¨â€ğŸ« Ã–ÄŸretmen Paneli</h1>
        <p>HoÅŸ geldiniz! Ã–ÄŸrenci yÃ¶netimi ve ders materyalleri</p>
    </div>

    <div class="upcoming-widget">
        <div class="widget-header">
            <h2>ğŸ“… YaklaÅŸan SÄ±navlar</h2>
            <a href="/teacher/exam-calendar">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
        </div>
        <div id="upcomingExams">
            <div style="text-align: center; padding: 30px; color: var(--gray-400);">
                <div class="loading-spinner" style="margin: 0 auto 12px;"></div>
                <p>YÃ¼kleniyor...</p>
            </div>
        </div>
    </div>

    <h2 class="section-title">ğŸš€ HÄ±zlÄ± EriÅŸim</h2>
    <div class="quick-access-grid">
        <div class="quick-card exams" onclick="window.location.href='/teacher/exams'">
            <span class="quick-card-icon">ğŸ“</span>
            <h3>SÄ±navlarÄ±m</h3>
            <p>SÄ±nav oluÅŸtur ve deÄŸerlendir</p>
        </div>
        <div class="quick-card assignments" onclick="window.location.href='/teacher/assignments'">
            <span class="quick-card-icon">ğŸ“š</span>
            <h3>Ã–devlerim</h3>
            <p>Ã–dev ver ve kontrol et</p>
        </div>
        <div class="quick-card announcements" onclick="window.location.href='/teacher/announcements'">
            <span class="quick-card-icon">ğŸ“¢</span>
            <h3>Duyurular</h3>
            <p>Ã–ÄŸrencilere duyuru yayÄ±nla</p>
        </div>
        <div class="quick-card questions" onclick="window.location.href='/teacher/questions'">
            <span class="quick-card-icon">ğŸ’¬</span>
            <h3>Ã–ÄŸrenci SorularÄ±</h3>
            <p>SorularÄ± cevapla</p>
        </div>
        <div class="quick-card reports" onclick="window.location.href='/teacher/reports'">
            <span class="quick-card-icon">ğŸ“Š</span>
            <h3>Raporlar</h3>
            <p>Performans analizleri</p>
        </div>
        <div class="quick-card bookworm" onclick="window.location.href='/teacher/book-worm'">
            <span class="quick-card-icon">ğŸ“–</span>
            <h3>Kitap Kurdu</h3>
            <p>Okuma takibi</p>
        </div>
        <div class="quick-card" onclick="window.location.href='/teacher/report-cards'" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
            <span class="quick-card-icon">ğŸ“„</span>
            <h3>Karne Analizi</h3>
            <p>Hata karneleri ve analiz raporlarÄ±</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function loadUpcomingExams() {
    try {
        const response = await fetch('/api/exam-calendar/all');
        const data = await response.json();
        const exams = data.exams || [];
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const upcomingExams = exams
            .filter(exam => new Date(exam.date + 'T00:00:00') >= today)
            .sort((a, b) => new Date(a.date) - new Date(b.date))
            .slice(0, 4);
        
        const container = document.getElementById('upcomingExams');
        
        if (upcomingExams.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--gray-400);">
                    <div style="font-size: 3rem; margin-bottom: 12px; opacity: 0.5;">ğŸ“…</div>
                    <p>YaklaÅŸan sÄ±nav bulunmuyor</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        upcomingExams.forEach(exam => {
            const dateObj = new Date(exam.date + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long' });
            const diffDays = Math.ceil((dateObj - today) / (1000 * 60 * 60 * 24));
            
            let badgeClass = 'later';
            let badgeText = `${diffDays} gÃ¼n sonra`;
            
            if (diffDays === 0) { badgeClass = 'today'; badgeText = 'BUGÃœN'; }
            else if (diffDays === 1) { badgeClass = 'tomorrow'; badgeText = 'YARIN'; }
            else if (diffDays <= 7) { badgeClass = 'soon'; badgeText = `${diffDays} GÃœN KALDI`; }
            
            html += `
                <div class="exam-item">
                    <div>
                        <div class="exam-item-title">${exam.description || exam.title}</div>
                        <div class="exam-item-meta">${formattedDate} â€¢ ${exam.classes || 'TÃ¼m sÄ±nÄ±flar'}</div>
                    </div>
                    <span class="exam-badge ${badgeClass}">${badgeText}</span>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
    } catch (error) {
        console.error('SÄ±navlar yÃ¼klenemedi:', error);
        document.getElementById('upcomingExams').innerHTML = `
            <div style="text-align: center; padding: 30px; color: var(--error-500);">
                <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ˜•</div>
                <p>YÃ¼kleme hatasÄ±</p>
            </div>
        `;
    }
}

loadUpcomingExams();
</script>
{% endblock %}
